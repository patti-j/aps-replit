@inject IJSRuntime JSRuntime

@if (ShowPassword)
{
    <DxTextBox Password="false" Text="@Value" Enabled="@Enabled" ReadOnly="@ReadOnly" TextChanged="ValueChanged" BindValueMode="BindValueMode.OnInput" ValidationEnabled="false">
        <Buttons>
            <DxEditorButton IconCssClass="fa fa-eye-slash" @onclick="(e) => ShowPassword = !ShowPassword"/>
            @if (ShowCopyButton)
            {
                <DxEditorButton IconCssClass="fa fa-copy" @onclick="CopyButtonClicked"/>
            }
        </Buttons>
    </DxTextBox>
}
else
{
    <DxTextBox Password="true" Text="@Value" Enabled="@Enabled" ReadOnly="@ReadOnly" TextChanged="ValueChanged" BindValueMode="BindValueMode.OnInput" NullText="@(Value?.Length > 0 ? new string(Enumerable.Range(1, DotCount).Select(s => 'â€¢').ToArray()) : "")" ValidationEnabled="false">
        <Buttons>
            <DxEditorButton IconCssClass="fa fa-eye" @onclick="(e) => ShowPassword = !ShowPassword"/>
            @if (ShowCopyButton)
            {
                <DxEditorButton IconCssClass="fa fa-copy" @onclick="CopyButtonClicked"/>
            }
        </Buttons>
    </DxTextBox>
}

@code {

    [Parameter]
    public string? Value { get; set; }
    [Parameter]
    public EventCallback<string> ValueChanged { get; set; }

    [Parameter]
    public bool Enabled { get; set; } = true;
    [Parameter]
    public bool ReadOnly { get; set; } = false;
    [Parameter]
    public bool ShowCopyButton { get; set; } = false;
    [Parameter]
    public int DotCount { get; set; } = 8;

    private bool ShowPassword;

    private async void CopyButtonClicked()
    {
        await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", [Value]);
    }

}