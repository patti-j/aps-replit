namespace PT.APSCommon;
//
// Jan 22, 2010
// Many objects in a Scenario have a unique base id across the entire scenario.
// The only objects I know of that aren't at this point are blocks, batches, and ids generated by FromRangeSetsManager.
// Blocks and batches are probably regenerated too frequently to have a scenario wide unique id, but setup ranges are static.

public class BaseIdGenerator : IPTSerializable, IEquatable<BaseIdGenerator>, IIdGenerator
{
    public BaseIdGenerator() { }

    #region IPTSerializable Members
    public BaseIdGenerator(IReader reader)
    {
        reader.Read(out m_nextId);

        //In 12409 we updated IDs to start at 0 going forward for better usability and readability
        if (m_nextId < 0)
        {
            InitNextId(0);
        }
    }

    public void Serialize(IWriter writer)
    {
        writer.Write(m_nextId);
    }

    public const int UNIQUE_ID = 50;

    public int UniqueId => UNIQUE_ID;
    #endregion

    private long m_nextId;

    public BaseId NextID()
    {
        unchecked
        {
            m_nextId++;
        }

        return new BaseId(m_nextId);
    }

    public void InitNextId(long a_id)
    {
        m_nextId = a_id;
    }

    public void Reset()
    {
        m_nextId = 0;
    }

    public bool Equals(BaseIdGenerator other)
    {
        if (ReferenceEquals(null, other))
        {
            return false;
        }

        if (ReferenceEquals(this, other))
        {
            return true;
        }

        return m_nextId == other.m_nextId;
    }

    public override bool Equals(object obj)
    {
        if (ReferenceEquals(null, obj))
        {
            return false;
        }

        if (ReferenceEquals(this, obj))
        {
            return true;
        }

        if (obj.GetType() != GetType())
        {
            return false;
        }

        return Equals((BaseIdGenerator)obj);
    }
}

public interface IIdGenerator
{
    BaseId NextID();
}